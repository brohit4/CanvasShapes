CanvasShapes={init:function(a){var b,c;return a=a||{},c=a.canvasConfig||{},b=function(a){var c,d,e,f=this;if(c=console,a=a||{},!b.validShapes.hasOwnProperty(a.type))return c&&c.error("Please pass a valid shape type. This is an invalid shape type--"+a.type),void 0;if(e=f.type=a.type,"number"!=typeof a.x||"number"!=typeof a.x||a.x<0||a.y<0)return c&&c.error("Co-ordinates missing for the created shape or onvalid co-ordinates"),void 0;if(f.x=a.x,f.y=a.y,d=b.defaultColor,f.fillStyle=a.fillStyle||d,"RECTANGLE"===e){if(!a.width||!a.height)return c&&c.error("Please pass in width and height for the rectangle"),void 0;f.width=a.width,f.height=a.height}if("CIRCLE"===e){if(!a.radius)return c&&c.error("Please pass in radius for the circle"),void 0;f.radius=a.radius}if("TEXT"===e){if(!a.text||!a.font)return c&&c.error("Please pass in the value of the text and the font size"),void 0;f.text=a.text,f.font=a.font}if("IMAGE"===e){if(!a.url||!a.width||!a.height)return c&&c.error("Some parameeters of the image are missing check url, width, height"),void 0;f.url=a.url,f.sourceCoords=a.sourceCoords,f.width=a.width,f.height=a.height}return f},b.shapes=[],b.defaultColor="#FBFBFB",b.shapeIndex=0,b.validShapes={RECTANGLE:!0,CIRCLE:!0,TEXT:!0,IMAGE:!0},b.decrementDepth=function(a,b){var c,d,e,f=this;for(c=f.shapes,e=c.length,b=b||e,b>=e&&(b=e-1),d=a;b>=d;d++)c[d].index=c[d].index-1},b.clearColor=a.clearColor||"#FFF",b.canvas=a.canvas,b.moveShapes=function(a){var c,d,e,f,g,h,i,j,k;for(i=a.length,d=b.shapes,g=0;i>g;g++){for(f=a[g],j=f.realIndex,e=d[j],c=e.affectedShapes(!1,!1,c).metaData,e.clearShape(),e.x=f.x,e.y=f.y,k=d.length,h=j+1;k>h;h++)d[h].index=h-1,c[h-1]=c[h];d.splice(j,1),e.index=d.length,d.push(e),c[d.length-1]=!0}for(k=d.length,g=0;k>g;g++)c[g]&&d[g].draw()},b.prototype={paint:function(){var a=this;a.index=b.shapeIndex++,b.shapes&&b.shapes.push(a),a.draw()},draw:function(a){var d,e,f,g,h=this;b.canvas?d=b.canvas:(d=document.createElement("canvas"),d.width=c.width||window.innerWidth-100,d.height=c.height||window.innerHeight,document.body.appendChild(d),b.canvas=d),e=d.getContext("2d"),a=a||{},e.fillStyle=a.fillStyle||h.fillStyle,"RECTANGLE"===h.type?e.fillRect(h.x,h.y,h.width,h.height):"CIRCLE"===h.type?(e.beginPath(),e.arc(h.x,h.y,h.radius,0,2*Math.PI,!1),e.closePath(),e.fill()):"TEXT"===h.type?(e.font=h.font,e.fillText(h.text,h.x,h.y)):"IMAGE"===h.type&&(h.img instanceof HTMLImageElement||(f=new Image,g=[f],h.sourceCoords&&(g=g.concat([h.sourceCoords.sx,h.sourceCoords.sy,h.sourceCoords.sw,h.sourceCoords.sh])),g=g.concat([h.x,h.y,h.width,h.height]),f.onload=function(){e.drawImage.apply(e,g)},f.src=h.url))},clearShape:function(){this.draw({fillStyle:b.clearColor})},move:function(a,c){var d=this;d.clearShape(),d.redrawAffectedShapes(),a&&(d.x=a),c&&(d.y=c),d.draw(),b.decrementDepth(d.index+1),b.shapes.splice(d.index,1),d.index=b.shapes.length,b.shapes.push(d)},contains:function(a){var b,c,d,e=this;return b=e.getRectCoordinates(),c=a.getRectCoordinates(),d=function(a,b,c){return a>=c.x&&a<=c.x+c.width&&b>=c.y&&b<=c.y+c.height?!0:!1},d(b.x,b.y,c)?!0:d(b.x+b.width,b.y,c)?!0:d(b.x+b.width,b.y+b.height,c)?!0:d(b.x,b.y+b.height,c)?!0:!1},containedShapes:function(a,c,d){var e,f,g,h,i=this,j=0,k=[];for(f=b.shapes,e=f.length,a=a||new Array(e);e>j;j++)(j!==i.index||c)&&(g=f[j],h=d?!a[g.index]&&i.index<=g.index:!a[g.index],h&&(i.contains(g)||g.contains(i))&&(k.push(g),a[g.index]=!0));return k},affectedShapes:function(a,c,d){var e,f,g,h,i=this,j=0,k=[];for(f=b.shapes,e=f.length,h=d||new Array(e),k=i.containedShapes(h,a,c);k.length;)g=k.splice(0,1)[0],k=k.concat(g.containedShapes(h,a));for(;e>j;j++)considerElement=j===i.index?a:!0,h[j]&&considerElement&&k.push(f[j]);return{shapes:k,metaData:h}},bringToFront:function(a){var c,d,e,f=this;c=f.index,d=a.index,d>c?(e=b.shapes,b.decrementDepth(c+1,d),f.index=d,e.splice(c,1),e.splice(d,0,f),a.redrawAffectedShapes(!0,!0)):console&&console.info("Shape already above")},modifyDimensions:function(a){var b,c,d,e,f=this;a=a||{},e=f.affectedShapes(!0).metaData,"RECTANGLE"===f.type?(b=a.width,"number"==typeof b&&b>=0&&(f.width=a.width),c=a.height,"number"==typeof c&&c>=0&&(f.height=a.height)):"CIRCLE"===f.type?(d=f.radius,"number"==typeof d&&d>=0&&(f.radius=a.radius)):"TEXT"===f.type&&(f.text=a.text||""),e=f.affectedShapes(!0,!0,e).shapes,f.redrawShapes(e)},moveToBackGround:function(a){var c,d,e,f=this;c=f.index,d=a.index,c>d?(e=b.shapes,b.decrementDepth(d+1,c),e.splice(d,1),e.splice(c,0,a),a.index=c,f.redrawAffectedShapes(!0,!0)):console&&console.info("Shape already below")},redrawContainedShapes:function(){var a,b=this;a=b.containedShapes(),b.redrawShapes(a)},redrawAffectedShapes:function(a,b){var c,d=this;c=d.affectedShapes(a,b).shapes,d.redrawShapes(c)},redrawShapes:function(a){var b,c=0;for(b=a.length;b>c;c++)a[c].draw()},getRectCoordinates:function(){var a,c,d,e,f,g=this;return"RECTANGLE"===g.type?a={x:g.x,y:g.y,width:g.width,height:g.height}:"CIRCLE"===g.type?a={x:g.x-g.radius,y:g.y-g.radius,width:2*g.radius,height:2*g.radius}:"TEXT"===g.type?(c=b.canvas,d=c.getContext("2d"),e=d.measureText(g.text).width,f=g.font,a={x:g.x,y:g.y,width:e,height:Number(f.substr(0,f.length-2))}):"IMAGE"===g.type&&(a={x:g.x,y:g.y,width:g.width,height:g.width}),a}},b}};